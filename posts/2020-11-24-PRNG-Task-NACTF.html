<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>WaletSec - 2020-11-24-PRNG-Task-NACTF</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="../css/syntax.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">WaletSec</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>2020-11-24-PRNG-Task-NACTF</h1>
            <article>
    <section class="header">
        Posted on November 24, 2020
        
    </section>
    <section>
        <h1 id="prng-task">PRNG Task</h1>
<h3 id="solution">Solution</h3>
<p>There are two ways to predict next numbers Mersenne Twister returns. The first is rebuilding its internal state using 624 integers. The second way is guessing the seed and guessing it shouldn’t be that hard, because source code we get tells us it’s rounded time.</p>
<p>Code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="im">import</span> socket</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="im">import</span> time</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="im">import</span> math</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="im">import</span> datetime</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>HOST <span class="op">=</span> <span class="st">&quot;challenges.ctfd.io&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>PORT <span class="op">=</span> <span class="dv">30264</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="kw">def</span> main():</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    s <span class="op">=</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    my_tm <span class="op">=</span> <span class="bu">round</span>(time.time() <span class="op">/</span> <span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    s.<span class="ex">connect</span>((HOST, PORT))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    srv_nums <span class="op">=</span> []</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;current time: </span><span class="sc">%f</span><span class="st">&quot;</span> <span class="op">%</span> my_tm)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>    recvd <span class="op">=</span> s.recv(<span class="dv">4096</span>).decode(<span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>        <span class="cf">if</span> <span class="bu">len</span>(srv_nums) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>            s.sendall(b<span class="st">&quot;r</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>            recvd <span class="op">=</span> s.recv(<span class="dv">128</span>).decode(<span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>            recvd <span class="op">=</span> recvd[:recvd.find(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>            srv_nums.append(<span class="bu">int</span>(recvd))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>            <span class="cf">continue</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>            <span class="cf">break</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;bruteforcing seed&quot;</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;searching for numbers:&quot;</span>, srv_nums)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>    flag_found <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;displaying progress...</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>    work_begin <span class="op">=</span> time.time()</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>    my_tm <span class="op">=</span> <span class="bu">round</span>(my_tm <span class="op">-</span> <span class="dv">30</span>, <span class="dv">6</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>        random.seed(my_tm)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>        my_rnd <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100000000</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>        <span class="cf">if</span> my_rnd <span class="op">==</span> srv_nums[<span class="dv">0</span>]:</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;found time seed: </span><span class="sc">%f</span><span class="st">&quot;</span> <span class="op">%</span> my_tm)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>            tmprng <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100000000</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>            <span class="bu">print</span>(tmprng)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>            <span class="cf">if</span> tmprng <span class="op">!=</span> srv_nums[<span class="dv">1</span>]:</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;second number doesn't match, skipping&quot;</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>                my_tm <span class="op">=</span> <span class="bu">round</span>(my_tm <span class="op">+</span> <span class="fl">0.000001</span>, <span class="dv">6</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>                <span class="cf">continue</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>            flag_found <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>            <span class="cf">break</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>        my_tm <span class="op">=</span> <span class="bu">round</span>(my_tm <span class="op">+</span> <span class="fl">0.000001</span>, <span class="dv">6</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>        <span class="cf">if</span> my_tm <span class="op">==</span> <span class="bu">float</span>(math.floor(my_tm)):</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="bu">int</span>(my_tm))</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>                work_end <span class="op">=</span> time.time()</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;finished job in </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> <span class="bu">str</span>(datetime.timedelta(seconds<span class="op">=</span>work_end <span class="op">-</span> work_begin)))</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>    <span class="cf">if</span> <span class="kw">not</span> flag_found:</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;seed not found&quot;</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>        <span class="cf">return</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">submitting the answer&quot;</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">server numbers&quot;</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>    <span class="cf">for</span> x <span class="kw">in</span> srv_nums:</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;| </span><span class="sc">%i</span><span class="st"> |&quot;</span> <span class="op">%</span> x, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a>    s.sendall(b<span class="st">&quot;g</span><span class="ch">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a>    first_rnd <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100000000</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>    recvd <span class="op">=</span> s.recv(<span class="dv">4096</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>    <span class="bu">print</span>(recvd)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a>    s.sendall(<span class="bu">str</span>(first_rnd).encode(<span class="st">&quot;utf-8&quot;</span>) <span class="op">+</span> b<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;sent first guess: </span><span class="sc">%i</span><span class="st">&quot;</span> <span class="op">%</span> first_rnd)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a>    second_rnd <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">100000000</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a>    recvd <span class="op">=</span> s.recv(<span class="dv">4096</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a>    <span class="bu">print</span>(recvd)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>    s.sendall(<span class="bu">str</span>(second_rnd).encode(<span class="st">&quot;utf-8&quot;</span>) <span class="op">+</span> b<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;sent second guess: </span><span class="sc">%i</span><span class="st">&quot;</span> <span class="op">%</span> second_rnd)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a>        recvd <span class="op">=</span> s.recv(<span class="dv">4096</span>).decode(<span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> recvd:</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true"></a>            <span class="cf">break</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true"></a>        <span class="bu">print</span>(recvd)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true"></a>    main()</span></code></pre></div>
<p>We run it and get the flag:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>found time seed: <span class="fl">16045235.553690</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="dv">95870824</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>finished job <span class="kw">in</span> <span class="dv">0</span>:03:<span class="fl">57.809325</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>submitting the answer</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>server numbers</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="op">|</span> <span class="dv">71504180</span> <span class="op">||</span> <span class="dv">95870824</span> <span class="op">|</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>b<span class="st">'Guess the next two random numbers for a flag!</span><span class="ch">\n</span><span class="st">Good luck!</span><span class="ch">\n</span><span class="st">Enter your first guess:</span><span class="ch">\n</span><span class="st">&gt; '</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>sent first guess: <span class="dv">94324429</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>b<span class="st">&quot;Wow, lucky guess... You won't be able to guess right a second time</span><span class="ch">\n</span><span class="st">Enter your second guess:</span><span class="ch">\n</span><span class="st">&gt; &quot;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>sent second guess: <span class="dv">68431170</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>What? You must have psychic powers... Well here<span class="st">'s your flag: </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="st">nactf</span><span class="sc">{ch000nky_turn1ps_1674973}</span></span></code></pre></div>
<h3 id="flag">Flag</h3>
<p>​ nactf{ch000nky_turn1ps_1674973}</p>
<h4 id="credits">Credits</h4>
<ul>
<li>Writeup by <a href="https://ctftime.org/user/85858">everl0stz</a></li>
<li>Solved by <a href="https://ctftime.org/user/85858">everl0stz</a></li>
<li>WaletSec 2020</li>
</ul>
<h4 id="license">License</h4>
<p><strong>CC BY 4.0</strong> WaletSec + everl0stz</p>
    </section>
</article>

        </main>

        <footer>
            <div>Source code available on 
                <a href="https://github.com/WaletSec/waletsec.github.io">GitHub</a></div>
            <div>Site proudly generated by
                <a href="http://jaspervdj.be/hakyll">Hakyll</a></div>
        </footer>
    </body>
</html>
